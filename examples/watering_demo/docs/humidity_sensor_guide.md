# ESP32-S3 湿度传感器开发指南

## 概述

本文档详细说明了基于电位器的湿度检测模块的实现方法、校准参数和开发注意事项。通过本指南，开发者可以快速理解系统工作原理，减少开发探索时间。

## 硬件规格

### 电位器参数
- 工作电压：3.3V DC
- ADC通道：ADC2
- 实测电压范围：0-3121mV

### 接口定义
- 信号输出：ADC2
- 供电：3.3V
- 地：GND

## 校准参数

### 出厂校准值
```c
// 2025-02-13校准
#define FACTORY_MIN_VOLTAGE    0    // mV，对应100%湿度
#define FACTORY_MAX_VOLTAGE    3121 // mV，对应0%湿度
```

### 电压-湿度映射关系
- 0mV → 100%湿度
- 3121mV → 0%湿度
- 线性映射公式：湿度% = (1 - 当前电压/最大电压) × 100

## 软件实现

### ADC采样优化
```c
#define NO_OF_SAMPLES 32   // 采样次数
uint32_t adc_reading = 0;
for (int i = 0; i < NO_OF_SAMPLES; i++) {
    adc_reading += adc_raw;  // 累加采样值
}
adc_reading /= NO_OF_SAMPLES; // 计算平均值
```

### 电压转换函数
```c
static int voltage2humidity(int v)
{
    if (v <= FACTORY_MIN_VOLTAGE) return 100;
    if (v >= FACTORY_MAX_VOLTAGE) return 0;
    
    float p = 1.0 - (float)v / FACTORY_MAX_VOLTAGE;
    return (int)(p * 100);
}
```

## 开发指南

### 初始化流程
1. ADC配置
   - 设置ADC通道
   - 配置采样参数
   - 初始化校准数据

2. 读取流程
   - 多次采样
   - 计算平均值
   - 转换为电压值
   - 映射为湿度百分比

### 调试技巧

#### 日志监控
系统会在关键点输出日志：
```
I (XXXX) app_humidity: Reached 0% (voltage: 3121 mV)
I (XXXX) app_humidity: Reached 100% (voltage: 0 mV)
```

#### 常见问题排查
1. 读数不稳定
   - 增加采样次数
   - 检查供电稳定性
   - 验证接地连接

2. 范围不准确
   - 确认电位器位置
   - 检查电压范围
   - 验证映射公式

## 性能参数

### 时间指标
- 采样延迟：< 1ms
- 处理时间：< 5ms
- 刷新频率：~20Hz

### 精度指标
- 电压分辨率：0.8mV
- 湿度分辨率：0.03%
- 重复性误差：< 1%

## 维护建议

### 定期检查
- 每月：验证电压范围
- 每季：检查机械性能
- 每年：完整校准

### 校准步骤
1. 将电位器转到最小位置
2. 记录最小电压值
3. 将电位器转到最大位置
4. 记录最大电压值
5. 更新校准常量

## 注意事项

1. 系统已经过出厂校准，正常使用无需重新校准
2. 校准值已固化在代码中，确保稳定性
3. 如需重新校准，请按维护建议执行
4. 建议定期检查电压范围，确保准确性

## 版本记录

### v1.0 (2025-02-13)
- 完成基础校准
- 建立标准映射关系
- 优化ADC采样
- 添加调试日志

## 技术支持

如有问题，请联系：
- 技术支持：support@codeium.com
- 文档维护：docs@codeium.com

---
最后更新：2025-02-13
